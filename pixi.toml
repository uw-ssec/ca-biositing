#                             VVVVVV  minimum `pixi` version
"$schema" = "https://pixi.sh/v0.55.0/schema/manifest/schema.json"

[workspace]
requires-pixi = ">=0.55,<1.0"
authors = ["SSEC Team"]
channels = ["conda-forge"]
name = "ca-biositing"
platforms = ["osx-arm64", "osx-64", "linux-64", "linux-aarch64"]
version = "0.1.0"

[environments]
default = ["datamodels", "pipeline", "webservice"]
py312 = ["py312", "datamodels", "pipeline", "webservice"]
py313 = ["py313", "datamodels", "pipeline", "webservice"]
gis = { features = ["qgis", "raster", "vector"], solve-group = "default" }
etl = { features = ["etl"], no-default-feature = true, solve-group = "default" }
frontend = { features = ["frontend"], no-default-feature = true, solve-group = "default" }


[tasks.qgis]
depends-on = [
    { task = "run-qgis", environment = "gis" }
]

[dependencies]
python = ">=3.12"
pre-commit = ">=4.2.0,<5"
pytest = ">=8.4.2,<9"
pytest-cov = ">=7.0.0,<8"
sqlmodel = ">=0.0.19,<0.1"
alembic = ">=1.13.2,<2"
psycopg2 = ">=2.9.9,<3"
python-dotenv = ">=1.0.1,<2"
pandas = ">=2.2.0,<3"
pyjanitor = "*"
gspread = "*"
gspread-dataframe = "*"
pydantic-settings = "*"
google-auth-oauthlib = "*"
prefect = "*"
uvicorn = ">=0.30.0,<1"
fastapi = ">=0.115.0,<1"
pip = ">=25.2,<26"
ipython = ">=9.6.0,<10"

[tasks]
pre-commit-all = "pre-commit run --all-files"
pre-commit-install = "pre-commit install"

[tasks.start-webservice]
cwd = "src"
cmd = "uvicorn ca_biositing.webservice.main:app --reload"

[tasks.test]
cmd = "python -m pytest tests/ --verbose"
description = "Run all tests"

[tasks.test-cov]
cmd = "python -m pytest tests/ --cov=src/ca_biositing --cov-report=html --cov-report=term-missing"
description = "Run all tests with coverage and HTML report"

[tasks.submodule-frontend-init]
cmd = "git submodule update --init frontend"
description = "Initialize only the frontend submodule."

[feature.qgis.dependencies]
qgis = "*"

[feature.qgis.tasks]
run-qgis = { cmd = "qgis", description = "Run QGIS for geospatial analysis and visualization." }

[feature.raster.dependencies]
rasterio = "*"
xarray = "*"

[feature.vector.dependencies]
shapely = "*"
pyproj = "*"

[feature.etl.dependencies]
pandas = "*"
sqlmodel = "*"
gspread = "*"
gspread-dataframe = "*"
psycopg2-binary = "*"
alembic = "*"
pydantic-settings = "*"
google-auth-oauthlib = "*"

[feature.py312.dependencies]
python = "3.12.*"

[feature.py313.dependencies]
python = "3.13.*"

[feature.frontend.dependencies]
nodejs = ">=18,<21"

[feature.frontend.tasks]
frontend-install = { cmd = "npm install", cwd = "frontend", description = "Install frontend dependencies." }
frontend-dev     = { cmd = "npm run dev", cwd = "frontend", description = "Run frontend in development mode." }
frontend-build   = { cmd = "npm run build", cwd = "frontend", description = "Build the production frontend bundle." }

[feature.datamodels.pypi-dependencies]
ca-biositing-datamodels = {path = "./src/ca_biositing/datamodels", editable = true }

[feature.pipeline.pypi-dependencies]
ca-biositing-pipeline = { path = "./src/ca_biositing/pipeline", editable = true }

[feature.webservice.pypi-dependencies]
ca-biositing-webservice = { path = "./src/ca_biositing/webservice", editable = true }
