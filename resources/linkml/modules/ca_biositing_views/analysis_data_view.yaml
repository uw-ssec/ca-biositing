id: https://w3id.org/ca_biositing/ca_biositing_views/analysis_data_view
name: analysis_data_view
prefixes:
  linkml: https://w3id.org/linkml/
imports:
  - linkml:types
  - ../core/base_entity
  - ../general_analysis/observation
  - ../resource_information/resource
  - ../methods_parameters_units/parameter
  - ../methods_parameters_units/unit

classes:
  AnalysisDataView:
    is_a: BaseEntity
    description: Denormalized observation data for analytical processing.
    annotations:
      sql_schema: ca_biositing
      materialized: true
      sql_definition: >
        SELECT
          obs.id,
          res.name as resource,
          '06000'::text as geoid,
          param.name as parameter,
          obs.value,
          u.name as unit
        FROM public.observation obs JOIN public.parameter param ON
        obs.parameter_id = param.id JOIN public.unit u ON obs.unit_id = u.id
        LEFT JOIN public.proximate_record pr ON obs.record_id = pr.record_id AND
        obs.record_type = 'proximate analysis' LEFT JOIN public.ultimate_record
        ur ON obs.record_id = ur.record_id AND obs.record_type = 'ultimate
        analysis' LEFT JOIN public.compositional_record cr ON obs.record_id =
        cr.record_id AND obs.record_type = 'compositional analysis' LEFT JOIN
        public.icp_record ir ON obs.record_id = ir.record_id AND obs.record_type
        = 'icp analysis' LEFT JOIN public.prepared_sample ps ON ps.id =
        COALESCE(pr.prepared_sample_id, ur.prepared_sample_id,
        cr.prepared_sample_id, ir.prepared_sample_id) LEFT JOIN
        public.field_sample fs ON fs.id = ps.field_sample_id LEFT JOIN
        public.resource res ON res.id = fs.resource_id
    slots:
      - resource
      - geoid
      - parameter
      - value
      - unit

slots:
  resource:
    range: string
  geoid:
    range: string
  parameter:
    range: string
  value:
    range: float
  unit:
    range: string
